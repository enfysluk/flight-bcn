<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FlightRadar BCN</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
  #map { height: 60vh; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f4f4f4; }
  #langToggle { margin: 10px; }
</style>
</head>
<body>
<button id="langToggle">中文</button>
<h1 id="title">FlightRadar BCN - Global Lowest Flight Prices from Barcelona</h1>
<div id="map"></div>
<table id="priceTable">
  <thead>
    <tr><th>Destination</th><th>Price (€)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const dataUrl = 'data/flights.json';
const map = L.map('map').setView([41.3851, 2.1734], 4); // BCN coords

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18
}).addTo(map);

let markers = [];
let flightsData = [];
let lang = 'en';

const translations = {
  en: {
    title: 'FlightRadar BCN - Global Lowest Flight Prices from Barcelona',
    destination: 'Destination',
    price: 'Price (€)',
    toggle: '中文'
  },
  zh: {
    title: '巴塞罗那全球最低价机票地图',
    destination: '目的地',
    price: '价格（欧元）',
    toggle: 'English'
  }
};

function updateTable() {
  const tbody = document.querySelector('#priceTable tbody');
  tbody.innerHTML = '';
  flightsData.forEach(flight => {
    const tr = document.createElement('tr');
    const tdDest = document.createElement('td');
    tdDest.textContent = flight.destination;
    const tdPrice = document.createElement('td');
    tdPrice.textContent = flight.price;
    tr.appendChild(tdDest);
    tr.appendChild(tdPrice);
    tbody.appendChild(tr);
  });
}

function updateMap() {
  markers.forEach(m => map.removeLayer(m));
  markers = [];
  flightsData.forEach(flight => {
    // 模拟坐标，这里用随机坐标，真实项目需要获取正确经纬度
    const lat = 41 + (Math.random() - 0.5) * 20;
    const lng = 2 + (Math.random() - 0.5) * 40;
    const marker = L.circleMarker([lat, lng], {
      radius: 8,
      fillColor: '#f03',
      color: '#000',
      weight: 1,
      opacity: 1,
      fillOpacity: 0.8
    }).addTo(map);
    marker.bindPopup(`${flight.destination}: €${flight.price}`);
    markers.push(marker);
  });
}

function loadData() {
  fetch(dataUrl)
    .then(res => res.json())
    .then(json => {
      flightsData = json;
      updateTable();
      updateMap();
    });
}

document.getElementById('langToggle').addEventListener('click', () => {
  lang = lang === 'en' ? 'zh' : 'en';
  document.getElementById('title').textContent = translations[lang].title;
  document.querySelector('#priceTable thead tr').innerHTML = 
    `<th>${translations[lang].destination}</th><th>${translations[lang].price}</th>`;
  document.getElementById('langToggle').textContent = translations[lang].toggle;
  updateTable();
});

loadData();
</script>
</body>
</html>
